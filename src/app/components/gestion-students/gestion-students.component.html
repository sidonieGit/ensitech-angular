<section class="d-flex">
	<!-- SIDEBAR -->
	<app-sidebar></app-sidebar>
	<!-- MAIN -->
	<main class="flex-grow-1">
		<app-topbar></app-topbar>

		<!-- Barre de recherche et bouton Ajouter -->
		<div class="d-flex justify-content-between align-items-center flex-wrap mt-4 p-4">
			<div class="col-6 col-md-9" style="height: 44px;">
				<div class="input-group">
					<span class="input-group-text" id="basic-addon1">
						<i class="hgi-stroke hgi-search-01"></i>
					</span>
					<input type="search" placeholder="Rechercher un étudiant..." class="form-control" [(ngModel)]="filtername"
						(ngModelChange)="updateFilteredStudents()" />
				</div>
			</div>
			<button class="primary-btn border-0" data-bs-toggle="modal" data-bs-target="#addStudentModal">
				Ajouter un étudiant <i class="hgi-stroke hgi-add-circle"></i>
			</button>
		</div>

		<!-- Liste des étudiants -->
		<div class="students-list mt-5 px-4">
			<table class="table border table-hover">
				<thead class="table-primary">
					<tr>
						<th><input type="checkbox" class="form-check-input" /></th>
						<th>Nom de Famille</th>
						<th>Prénom</th>
						<th>Date de Naissance</th>
						<th>Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let student of filteredStudents">
						<td><input type="checkbox" class="form-check-input" /></td>

						<td>{{ student.lastName | titlecase }}</td>
						<td>{{ student.firstName | titlecase }}</td>
						<td>{{ student.birthday| date : 'dd/MM/yyyy' }}</td>

						<td>
							<div class="dropdown">
								<a href="#" class="text-decoration-none text-black" id="dropdownMenuButton" data-bs-toggle="dropdown"
									aria-expanded="false">
									<i class="hgi-stroke hgi-more-vertical"></i>
								</a>
								<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
									<li><a class="dropdown-item" href="javascript:void(0);" (click)="editStudent(student)"
											data-bs-toggle="modal" data-bs-target="#editStudentModal">Modifier</a>
									</li>
									<li><a class="dropdown-item" href="javascript:void(0);" (click)="viewStudent(student)"
											data-bs-toggle="modal" data-bs-target="#viewStudentModal">Voir les
											informations</a></li>
									<li><a class="dropdown-item" href="javascript:void(0);" (click)="openAssociateCoursesModal(student)"
											data-bs-toggle="modal" data-bs-target="#associateCoursesModal">Associer un
											cours</a></li>
									<li><a class="dropdown-item" href="javascript:void(0);"
											(click)="deleteStudent(student.id)">Supprimer</a></li>
								</ul>
							</div>
						</td>

					</tr>
				</tbody>
			</table>
			<div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
				<p>{{ filteredStudents.length }} résultats</p>
				<nav aria-label="Page navigation">
					<ul class="pagination">
						<li class="page-item">
							<a class="page-link" href="#" aria-label="Previous">&lt;</a>
						</li>
						<li class="page-item">
							<a class="page-link" href="#" aria-label="Next">&gt;</a>
						</li>
					</ul>
				</nav>
			</div>
		</div>
	</main>

	<!-- Modal pour ajouter un étudiant -->
	<div class="modal fade" id="addStudentModal" tabindex="-1" aria-labelledby="addStudentModalLabel" aria-hidden="true">
		<!-- CHANGÉ : ID -->
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Ajouter un étudiant</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<form (ngSubmit)="addStudent()">
						<div class="mb-3">
							<label for="lastName" class="form-label">Nom de famille</label> <!-- CHANGÉ -->
							<input type="text" [(ngModel)]="newStudent.lastName" name="lastName" placeholder="Nom de famille" required
								class="form-control" />
						</div>
						<div class="mb-3">
							<label for="firstName" class="form-label">Prénom</label> <!-- CHANGÉ -->
							<input type="text" [(ngModel)]="newStudent.firstName" name="firstName" placeholder="Prénom" required
								class="form-control" />
						</div>
						<div class="mb-3">
							<label for="email" class="form-label">Email</label>
							<input class="form-control" type="email" [(ngModel)]="newStudent.email" name="email" placeholder="Email"
								required />
						</div>
						<div class="mb-3">
							<label for="telephone" class="form-label">Téléphone</label>
							<input class="form-control" type="text" [(ngModel)]="newStudent.telephone" name="telephone"
								placeholder="Téléphone" />
						</div>
						<!-- Vous pouvez ajouter les autres champs ici : address, birthday, gender -->
						<div class="modal-footer">
							<button type="submit" class="primary-btn border-0" data-bs-dismiss="modal">Ajouter</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal pour visualiser les informations d'un étudiant -->
	<div class="modal fade" id="viewStudentModal" tabindex="-1" aria-labelledby="viewStudentModalLabel"
		aria-hidden="true"> <!-- CHANGÉ : ID -->
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Détails de l'étudiant</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" *ngIf="selectedStudent"> <!-- Ajout de *ngIf pour éviter les erreurs -->
					<p><strong>Nom de famille :</strong> {{ selectedStudent.lastName }}</p> <!-- CHANGÉ -->
					<p><strong>Prénom :</strong> {{ selectedStudent.firstName }}</p> <!-- CHANGÉ -->
					<p><strong>Matricule :</strong> {{ selectedStudent.matricule }}</p> <!-- Ajout du matricule -->
					<p><strong>Email :</strong> {{ selectedStudent.email }}</p>
					<p><strong>Téléphone :</strong> {{ selectedStudent.telephone }}</p>
					<p><strong>Date de naissance :</strong> {{ selectedStudent.birthday | date: 'dd/MM/yyyy' }}</p>
					<!-- CHANGÉ -->
					<p><strong>Genre :</strong> {{ selectedStudent.gender }}</p> <!-- Ajout du genre -->
					<p><strong>Cours associés :</strong> {{ getCourseTitles(selectedStudent.courses) }}</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal pour modifier un étudiant -->
	<div class="modal fade" id="editStudentModal" tabindex="-1" aria-labelledby="editStudentModalLabel"
		aria-hidden="true"> <!-- CHANGÉ : ID -->
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Modifier les informations de l'étudiant</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body" *ngIf="editingStudent">
					<form (ngSubmit)="saveEditStudent()">
						<div class="mb-3">
							<label for="editLastName" class="form-label">Nom de famille</label> <!-- CHANGÉ -->
							<input type="text" [(ngModel)]="editingStudent.lastName" name="editLastName" placeholder="Nom de famille"
								required class="form-control" />
						</div>
						<div class="mb-3">
							<label for="editFirstName" class="form-label">Prénom</label> <!-- CHANGÉ -->
							<input type="text" [(ngModel)]="editingStudent.firstName" name="editFirstName" placeholder="Prénom"
								required class="form-control" />
						</div>
						<div class="mb-3">
							<label for="editEmail" class="form-label">Email</label>
							<input type="email" [(ngModel)]="editingStudent.email" name="editEmail" placeholder="Email" required
								class="form-control" />
						</div>
						<div class="mb-3">
							<label for="editTelephone" class="form-label">Téléphone</label>
							<input type="text" [(ngModel)]="editingStudent.telephone" name="editTelephone" placeholder="Téléphone"
								class="form-control" />
						</div>
						<button type="submit" class="primary-btn border-0" data-bs-dismiss="modal">Enregistrer</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal pour associer un ou plusieurs cours à un étudiant -->
	<div class="modal fade" id="associateCoursesModal" tabindex="-1" aria-labelledby="associateCoursesModalLabel"
		aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header" *ngIf="selectedStudent"> <!-- Ajout de *ngIf -->
					<h5 class="modal-title">Associer des cours à {{ selectedStudent.firstName }} {{ selectedStudent.lastName }}
					</h5> <!-- CHANGÉ -->
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<form>
						<div *ngFor="let course of coursesForModal">
							<input type="checkbox" [(ngModel)]="course.selected" [name]="'course_' + course.id" />
							<label>{{ course.title }}</label>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" (click)="associateCourses()" data-bs-dismiss="modal">
						Associer
					</button>
				</div>
			</div>
		</div>
	</div>

</section>